\documentclass{article}
\usepackage[T1]{fontenc}
\usepackage[ngerman,english]{babel}
\usepackage[latin1]{inputenc}
\usepackage{lmodern,calc,microtype,parskip,lipsum,booktabs,textcomp,csquotes,enumerate,amssymb,
  vmargin,fancyhdr,fixltx2e,makeidx,listings,ellipsis,remreset,xcolor,lastpage,caption,fancybox,verbatim,amsmath}
\usepackage{graphicx}
\usepackage[pdftex]{hyperref}
\usepackage{amsmath,chngcntr}
\usepackage{listings}

% Title
\def\thetitle{Multimedia Datenbanken --- Projekt }

% ------------------------------------------
% -------- xcolor - (Tango)
% ------------------------------------------

\definecolor{LightButter}{rgb}{0.98,0.91,0.31}
\definecolor{LightOrange}{rgb}{0.98,0.68,0.24}
\definecolor{LightChocolate}{rgb}{0.91,0.72,0.43}
\definecolor{LightChameleon}{rgb}{0.54,0.88,0.20}
\definecolor{LightSkyBlue}{rgb}{0.45,0.62,0.81}
\definecolor{LightPlum}{rgb}{0.68,0.50,0.66}
\definecolor{LightScarletRed}{rgb}{0.93,0.16,0.16}
\definecolor{Butter}{rgb}{0.93,0.86,0.25}
\definecolor{Orange}{rgb}{0.96,0.47,0.00}
\definecolor{Chocolate}{rgb}{0.75,0.49,0.07}
\definecolor{Chameleon}{rgb}{0.45,0.82,0.09}
\definecolor{SkyBlue}{rgb}{0.20,0.39,0.64}
\definecolor{Plum}{rgb}{0.46,0.31,0.48}
\definecolor{ScarletRed}{rgb}{0.80,0.00,0.00}
\definecolor{DarkButter}{rgb}{0.77,0.62,0.00}
\definecolor{DarkOrange}{rgb}{0.80,0.36,0.00}
\definecolor{DarkChocolate}{rgb}{0.56,0.35,0.01}
\definecolor{DarkChameleon}{rgb}{0.30,0.60,0.02}
\definecolor{DarkSkyBlue}{rgb}{0.12,0.29,0.53}
\definecolor{DarkPlum}{rgb}{0.36,0.21,0.40}
\definecolor{DarkScarletRed}{rgb}{0.64,0.00,0.00}
\definecolor{Aluminium1}{rgb}{0.93,0.93,0.92}
\definecolor{Aluminium2}{rgb}{0.82,0.84,0.81}
\definecolor{Aluminium3}{rgb}{0.73,0.74,0.71}
\definecolor{Aluminium4}{rgb}{0.53,0.54,0.52}
\definecolor{Aluminium5}{rgb}{0.33,0.34,0.32}
\definecolor{Aluminium6}{rgb}{0.18,0.20,0.21}
\definecolor{Brown}{cmyk}{0,0.81,1,0.60}
\definecolor{OliveGreen}{cmyk}{0.64,0,0.95,0.40}
\definecolor{CadetBlue}{cmyk}{0.62,0.57,0.23,0}

% ------------------------------------------
% -------- vmargin
% ------------------------------------------

%\setmarginsrb{hleftmargini}{htopmargini}{hrightmargini}{hbottommargini}%{hheadheighti}{hheadsepi}{hfootheighti}{hfootskipi}
\setpapersize{A4}
\setmarginsrb{3cm}{1cm}{3cm}{1cm}{6mm}{7mm}{5mm}{15mm}

% ------------------------------------------
% -------- fancyhdr
% ------------------------------------------
%\fancyheadoffset[L]{\marginparsep+\marginparwidth}
\fancyhf{}
\fancyhead[L]{\bfseries{\nouppercase{\thetitle}}}
\fancyhead[R]{\bfseries{Seite \thepage\ von \pageref{LastPage}}}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0pt}
\fancypagestyle{plain}{
\fancyhf{}
\fancyfoot[R]{\bfseries{Seite \thepage\ von \pageref{LastPage}}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
}

% ------------------------------------------
% -------- hyperref
% ------------------------------------------

\hypersetup{
%breaklinks=true,
pdfborder={0 0 0},
bookmarks=true, % show bookmarks bar?
unicode=false, % non-Latin characters in AcrobatÂ’s bookmarks
pdftoolbar=true, % show AcrobatÂ’s toolbar?
pdfmenubar=true, % show AcrobatÂ’s menu?
pdffitwindow=true, % window fit to page when opened
pdfstartview={FitH}, % fits the width of the page to the window
pdftitle={Multimedia Datenbanken Ãœbung}, % title
pdfauthor={Huber Bastian, Daniel Watzinger}, % author
    pdfsubject={Ãœbungsblatt}, % subject of the document
    pdfcreator={Team Amazonen}, % creator of the document
    pdfproducer={Team Amazonen}, % producer of the document
    pdfkeywords={VAnalyzer}, % list of keywords
    pdfnewwindow=true, % links in new window
    colorlinks=true, % false: boxed links; true: colored links
    linkcolor=black, % color of internal links
    citecolor=black, % color of links to bibliography
    filecolor=magenta, % color of file links
    urlcolor=DarkSkyBlue % color of external links
}

% ------------------------------------------
% -------- listings
% ------------------------------------------
 
\lstset{
breakautoindent=true,
breakindent=2em,
breaklines=true,
tabsize=4,
frame=blrt,
frameround=tttt,
captionpos=b,
basicstyle=\scriptsize\ttfamily,
keywordstyle={\color{SkyBlue}},
commentstyle={\color{OliveGreen}},
stringstyle={\color{OliveGreen}},
showspaces=false,
%numbers=right,
%numberstyle=\scriptsize,
%stepnumber=1,
%numbersep=5pt,
%showtabs=false
prebreak = \raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}},
aboveskip={1.5\baselineskip},
columns=fixed,
upquote=true,
extendedchars=true
}
\fontsize{3mm}{4mm}\selectfont

% ------------------------------------------
% -------- misc
% ------------------------------------------
\newcommand{\bibliographyname}{Bibliography}
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}
\clubpenalty = 10000
\widowpenalty = 10000
\displaywidowpenalty = 10000
\setlength\fboxsep{6pt}
\setlength\fboxrule{1pt}
\renewcommand*\oldstylenums[1]{{\fontfamily{fxlj}\selectfont #1}}
%% Set table margins.
{\renewcommand{\arraystretch}{2}
\renewcommand{\tabcolsep}{0.4cm}}

\renewcommand{\thesubsection}{\alph{subsection})}
\newcommand{\mysection}[1]{\section*{#1} \setcounter{subsection}{0}}


\bibliographystyle{alpha}
% ------------------------------------------
% -------- hyphenation rules
% ------------------------------------------
%\hyphenation{net.-semanticmetadata.-lire.-imageanalysis.-mpeg7m net.-semanticmetadata.-lire.-imageanalysis}

\author{Bastian Huber\\(51432) \and Sebastian Rainer\\(50882) \and Daniel Watzinger\\(51746) \and Benedikt Preis \\(53279)}
\title{\textbf{\huge{\thetitle}}\\\large\textsc{Gruppe 13}}
\date{\today}

\begin{document}

% Specify hyphenation rules.
\hyphenation{}

\maketitle

\pagestyle{fancy}


\mysection{Aufgabe 1: Color Structure Descriptor}
  \subsection{Fehler der mitgelieferten Klasse}
    Die vorgegebene Implementierung ist nicht nur an einer Stelle fehlerhaft. Nachfolgend werden einige Mängel aufgezählt.
    \begin{lstlisting}[language=Java]
int temp[][] =  new int[(int)height - 1][(int)width - 1];
    \end{lstlisting}
    Das Array wird zu klein initialisiert. Damit fehlt der rechte und untere Rand des Bildes und wird nicht bei der Berechnung berücksichtigt.
    
    
    \begin{lstlisting}[language=Java]
int ir[][] = temp;
int ig[][] = temp;
int ib[][] = temp;

int iH[][]    = temp;
int iMax[][]  = temp;
int iMin[][]  = temp;
int iDiff[][] = temp;
int iSum[][]  = temp;

...

for (int ch = 0; ch < (int)height - 1; ch++) {
	for (int cw = 0; cw < (int)width - 1; cw++) {
		ir[ch][cw] = mf.getPixelAt(ch,cw).getComponent(0); // RED
		ig[ch][cw] = mf.getPixelAt(ch,cw).getComponent(1); // GREEN
		ib[ch][cw] = mf.getPixelAt(ch,cw).getComponent(2); // BLUE

		int[] tempHMMD = RGB2HMMD(ir[ch][cw],ig[ch][cw],ib[ch][cw]);
		iH[ch][cw]   = tempHMMD[0];						// H
		iMax[ch][cw] = tempHMMD[1];						// Max
		iMin[ch][cw] = tempHMMD[2]; 						// Min
		iDiff[ch][cw]= tempHMMD[3]; 						// Diff
		iSum[ch][cw] = tempHMMD[4]; 						// Sum
		}
}
    \end{lstlisting}
    Die Implementierung deklariert 8 Arrays (\emph{ir, ig, ib, iH, iMax, iMin, iDiff, iSum}) für die RGB-Kanäle und die bei der Konvertierung in den
    \emph{HMMD-ColorSpace} anfallenden Parameter. Diese werden aber nicht neu initialisiert sondern referenzieren alle auf das selbe Array.
    Zufällig wird hier also immer der \emph{BLUE}-Wert des Pixels verwendet. Zudem wird das Array an der jeweiligen Stelle 
    mehrmals bei der Zuweisung der \emph{HMMD}-Parameter überschrieben.
    
    
    \begin{lstlisting}[language=Java]
private float[] reQuantization(float[] colorHistogramTemp) {

	float[] uniformCSD = new float[colorHistogramTemp.length];

	for (int i=0; i < colorHistogramTemp.length; i++)
	{
		// System.out.print(colorHistogramTemp[i] + " ");
		// System.out.println(" --- ");

		if (colorHistogramTemp[i] == 0) uniformCSD[i] = 0; //
		else if (colorHistogramTemp[i] < 0.000000001f) uniformCSD[i] = (int)Math.round( ( ((float)colorHistogramTemp[i] - 0.32f ) / ( 1f - 0.32f ) ) * 140 + (115 - 35 - 35 - 20 - 25 - 1) );	 // (int)Math.round((1f / 0.000000001f) * (float)colorHistogramTemp[i]);
		else if (colorHistogramTemp[i] < 0.037f) uniformCSD[i] = (int)Math.round( ( ((float)colorHistogramTemp[i] - 0.32f ) / ( 1f - 0.32f ) ) * 140 + (115 - 35 - 35 - 20 - 25));
		else if (colorHistogramTemp[i] < 0.08f) uniformCSD[i] = (int)Math.round( ( ((float)colorHistogramTemp[i] - 0.32f ) / ( 1f - 0.32f ) ) * 140 + (115 - 35 - 35 - 20));
		else if (colorHistogramTemp[i] < 0.195f) uniformCSD[i] = (int)Math.round( ( ((float)colorHistogramTemp[i] - 0.32f ) / ( 1f - 0.32f ) ) * 140 + (115 - 35 - 35));
		else if (colorHistogramTemp[i] < 0.32f) uniformCSD[i] = (int)Math.round( ( ((float)colorHistogramTemp[i] - 0.32f ) / ( 1f - 0.32f ) ) * 140 + (115 - 35));
		else if (colorHistogramTemp[i] > 0.32f) uniformCSD[i] = (int)Math.round( ( ((float)colorHistogramTemp[i] - 0.32f ) / ( 1f - 0.32f ) ) * 140 + 115);
		else uniformCSD[i] = (int)Math.round((255f / 1f) * (float)colorHistogramTemp[i]);

	}

	return uniformCSD;
}
	\end{lstlisting}
	Die Methode soll die \emph{non-uniform Quantisation} auf \emph{8-Bit}-Werte der Bin-Werte, wie im Standard vorgeschrieben, sicherstellen.
  Alle Werte werden mit \emph{(1f - 0.32f)} skaliert. Dies ist aber im Allgemeinen nicht richtig. Außerdem benennt der Autor seine Methode widersprüchlich mit \emph{reQuantization},
  obwohl diese eher \emph{quantization} heißen müsste.
  Die \emph{Requantisierung} (von bereits quantisierten Bin-Werten) kommt lediglich beim Berechnen der Distanz von 
  Deskriptoren mit unterschiedlicher Anzahl an Bins (256, 128, 64, 28) zum Einsatz.
	
	Unter anderem wurde die Berechnung der Bin-Indizes sowie die Umwandlung in den \emph{HMMD-Farbraum} (\mbox{\texttt{diff = (max - min) / 2}})
  falsch implementiert.
  \begin{lstlisting}[language=Java]
if (M == 256) {
  offset = 0;
  m = (int)((iH[yy][xx] / M) * quantTable[offset+subspace] + (iSum[yy][xx] / M) * quantTable[offset+subspace+1]);
}
  \end{lstlisting}
  
  Für die Berechnung der Bin-Indizes wird der 3-dimensionale \emph{HMMD-Farbraum} partitioniert. Die Nummerierung erfolgt laut Standard zuerst
  von unten nach oben entlang der \emph{Sum-Achse}, anschließend orthogonal entlang der \emph{Hue-Achse} und schließlich von \emph{subspace}
  (Aufteilung der \emph{Diff-Achse}) zu \emph{subspace}. Dies wurde ebenfalls nicht berücksichtigt.
  
  Abschließend werden Bilder im Querformat von der vorliegenden Implementierung des \emph{Color Structure Descriptors} nicht unterstützt.

\begin{lstlisting}[language=Java]
if (width > height) {
  System.out.println("\nExit - vizir bug: file unsupported -> MediaFrame.getPixelAt");
  System.exit(0);
}
\end{lstlisting}  
  

  Als Konsequenz haben wir uns entschlossen, den \emph{Color Structure Descriptor} streng nach Standard selbst zu implementieren.
    
  \subsection{Eigene Implementierung}
    Unsere eigene Implementierung ist eine vollständige Implementierung des \emph{MPEG-7 Color Structure Descriptor} laut Standard. Sie beinhaltet zusätzlich
    die sogenannte \emph{Requantisierung}. Sie ermöglicht es zwei Deskriptoren mit unterschiedlicher Anzahl an Bins (256, 128, 64, 32) zu
    vergleichen indem der größere der beiden Deskriptoren durch Zusammenfassen von Bins (\emph{Bin-Unification}) verkleinert wird.
    Die Implementierung ist zudem paralellisiert und laufzeitoptimiert. 
    
    Als Distanzmetrik nutzen wir eine gewichtete Variante der $L^1$-Norm. Sie erzielt sehr gute Ergebnisse auf dem Gebiet der
    \emph{Human Recognition} und des \emph{Body Recognition}\cite{Kriech06}.
$$
  weight_{csd,csd'}(i) = \frac{csd(i) + csd'(i)}{\sum\limits_{k = 1}^N csd(k) + csd'(k)}
$$
$$
  distance(csd,csd') = \sum\limits_{i = 1}^N   weight_{csd,csd'}(i) \cdot |csd(i) - csd'(i)|
$$
  \subsection{Integration der Implementierung in Lire}
    \begin{itemize}
      \item Die Klasse \emph{ColorStructurDescriptorImplementation.java} im Paket \emph{net.semanticmetadata.lire.imageanalysis.mpeg7}
            enthält die Implementierung des \emph{Color Structure Descriptors}.
            Desweiteren wurde eine Klasse \emph{ColorStructurDescriptor.java} im Paket \emph{net.semanticmetadata.lire.imageanalysis}
            die das \emph{LireFeature} Interface implementiert erstellt.
            Diese bildet die Schnittstelle zwischen der Implementierung des \emph{MPEG-7 Color Structur Descriptors} und \emph{LIRE}.
            Es wird lediglich der Deskriptor serialisiert und deserialisiert und die Berechnungen delegiert.
      \item Zusätzlich wurde die Klasse \emph{DocumentBuilderFactory} erweitert, um den Deskriptor innerhalb des Frameworks verfügbar zu machen.
    \end{itemize}

\mysection{Aufgabe 2: Test Applikation}
  Der Entwurf der GUI richtet sich nach den Anforderungen die in der Aufgabenstellung verlangt sind.
  Dabei teilt sich unser Applikation in GUI und Model. Das Model interagiert mit LIRE indem es einen
  Index basieren auf ausgewählten Features für eine Menge von Bildern erzeugen kann. Zudem gibt es die Möglichkeit, eine \emph{Query by Example} Suche basierend auf
  einem spezifischen Feature anzustoßen. Die Suchergebnisse werden mitsamt den von \emph{Lire} berechneten Scorewerten angezeigt.
  
\mysection{Aufgabe 3: Bewertung}
Unsere Vorgehensweise bei dieser Aufgabe ist wie folgt:
  \begin{itemize}
    \item Wir nehmen ein Beispielbild und suchen die subjektiv 10 ähnlichsten Bilder
    \item Wir zählen die zu dem Beispielbild relevante Dokumente
    \item Dann Werten wir die Ergebnisse des Systems aus für $k=10$ Bilder.
  \end{itemize}
  
  \subsection{Bilder 0 - 99.jpg}
    \begin{itemize}
      \item Query By 1.jpg
      \item Relevante Bilder: 88
      \item Subjektive Top 10: 1, 10, 11, 16, 21, 36, 66, 74, 92, 97
    \end{itemize}
    
    \begin{center}
    	\begin{tabular}{l|l|l}
    		                        & Precision           & Recall \\
    		                        \hline
    		ColorLayout             & 0.2                 & 0.0227 \\
    		EdgeHistogram           & 0.3                 & 0.0341 \\
    		ColorStructurDescriptor & 0.3                 & 0.0341 \\
    		ScalableColorDescriptor & 0.2                 & 0.0227 \\
    		AutoColorCorrelogram    & 0.1                 & 0.0114 \\
    		CEED                    & 0.4                 & 0.0455 \\
    		FCTH                    & 0.4                 & 0.0455 \\
    		JCD                     & 0.3                 & 0.0341 \\
    		ColorHistorgram         & 0.1                 & 0.0114 \\
    		Tamura                  & 0.2                 & 0.0227 \\
    		Gabor                   & 0.1                 & 0.0114 \\
    	\end{tabular}
    \end{center}
    
    Somit kann für diese Bildmenge festgehalten werden, dass im Bezug auf die Ähnlichkeit zu 1.jpg, der CEED und FCTH Deskriptor am besten geeignet ist.
    
Eine Beschreibung Ihrer Methodik für Aufgabe 3, und eine Zusammenfassung der Ergebnisse

\bibliography{bib}

\end{document}
